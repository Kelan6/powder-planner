'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var proxy = function (a, b) { return function (e) { return b(a(e)); }; };

var bind = function (el, event, callback) { return el.addEventListener && el.addEventListener(event, callback); };

var unbind = function (el, event, callback) { return el && el.removeEventListener && el.removeEventListener(event, callback); };

var noop = function () { /* empty */ };

var preventDefault = function (e) { return e.preventDefault(); };

var touchRegExp = /touch/;

// 300ms is the usual mouse interval;
// // However, an underpowered mobile device under a heavy load may queue mouse events for a longer period.
var IGNORE_MOUSE_TIMEOUT = 2000;

function normalizeEvent(e) {
    if (e.type.match(touchRegExp)) {
        return {
            pageX: e.changedTouches[0].pageX,
            pageY: e.changedTouches[0].pageY,
            clientX: e.changedTouches[0].clientX,
            clientY: e.changedTouches[0].clientY,
            type: e.type,
            originalEvent: e,
            isTouch: true
        };
    }

    return {
        pageX: e.pageX,
        pageY: e.pageY,
        clientX: e.clientX,
        clientY: e.clientY,
        offsetX: e.offsetX,
        offsetY: e.offsetY,
        type: e.type,
        ctrlKey: e.ctrlKey,
        shiftKey: e.shiftKey,
        altKey: e.altKey,
        originalEvent: e
    };
}

var Draggable = function Draggable(ref) {
    var this$1 = this;
    var press = ref.press; if ( press === void 0 ) press = noop;
    var drag = ref.drag; if ( drag === void 0 ) drag = noop;
    var release = ref.release; if ( release === void 0 ) release = noop;
    var mouseOnly = ref.mouseOnly; if ( mouseOnly === void 0 ) mouseOnly = false;

    this._pressHandler = proxy(normalizeEvent, press);
    this._dragHandler = proxy(normalizeEvent, drag);
    this._releaseHandler = proxy(normalizeEvent, release);
    this._ignoreMouse = false;
    this._mouseOnly = mouseOnly;

    this._touchstart = function (e) {
        if (e.touches.length === 1) {
            this$1._pressHandler(e);
        }
    };

    this._touchmove = function (e) {
        if (e.touches.length === 1) {
            this$1._dragHandler(e);
        }
    };

    this._touchend = function (e) {
        // the last finger has been lifted, and the user is not doing gesture.
        // there might be a better way to handle this.
        if (e.touches.length === 0 && e.changedTouches.length === 1) {
            this$1._releaseHandler(e);
            this$1._ignoreMouse = true;
            setTimeout(this$1._restoreMouse, IGNORE_MOUSE_TIMEOUT);
        }
    };

    this._restoreMouse = function () {
        this$1._ignoreMouse = false;
    };

    this._mousedown = function (e) {
        var which = e.which;

        if ((which && which > 1) || this$1._ignoreMouse) {
            return;
        }

        bind(this$1.document, "mousemove", this$1._mousemove);
        bind(this$1.document, "mouseup", this$1._mouseup);
        this$1._pressHandler(e);
    };

    this._mousemove = function (e) {
        this$1._dragHandler(e);
    };

    this._mouseup = function (e) {
        unbind(this$1.document, "mousemove", this$1._mousemove);
        unbind(this$1.document, "mouseup", this$1._mouseup);
        this$1._releaseHandler(e);
    };

    this._pointerdown = function (e) {
        if (e.isPrimary && e.button === 0) {
            bind(this$1.document, "pointermove", this$1._pointermove);
            bind(this$1.document, "pointerup", this$1._pointerup);
            bind(this$1.document, "pointercancel", this$1._pointerup);
            bind(this$1.document, "contextmenu", preventDefault);

            this$1._pressHandler(e);
        }
    };

    this._pointermove = function (e) {
        if (e.isPrimary) {
            this$1._dragHandler(e);
        }
    };

    this._pointerup = function (e) {
        if (e.isPrimary) {
            unbind(this$1.document, "pointermove", this$1._pointermove);
            unbind(this$1.document, "pointerup", this$1._pointerup);
            unbind(this$1.document, "pointercancel", this$1._pointerup);
            unbind(this$1.document, "contextmenu", preventDefault);

            this$1._releaseHandler(e);
        }
    };
};

var prototypeAccessors = { document: {} };

Draggable.supportPointerEvent = function supportPointerEvent () {
    return (typeof window !== 'undefined') && window.PointerEvent;
};

prototypeAccessors.document.get = function () {
    return this._element
    ? this._element.ownerDocument
    : document;
};

Draggable.prototype.bindTo = function bindTo (element) {
    if (element === this._element) {
        return;
    }

    if (this._element) {
        this._unbindFromCurrent();
    }

    this._element = element;
    this._bindToCurrent();
};

Draggable.prototype._bindToCurrent = function _bindToCurrent () {
    var element = this._element;

    if (this._usePointers()) {
        bind(element, "pointerdown", this._pointerdown);
        return;
    }

    bind(element, "mousedown", this._mousedown);

    if (!this._mouseOnly) {
        bind(element, "touchstart", this._touchstart);
        bind(element, "touchmove", this._touchmove);
        bind(element, "touchend", this._touchend);
    }
};

Draggable.prototype._unbindFromCurrent = function _unbindFromCurrent () {
    var element = this._element;

    if (this._usePointers()) {
        unbind(element, "pointerdown", this._pointerdown);
        unbind(this.document, "pointermove", this._pointermove);
        unbind(this.document, "pointerup", this._pointerup);
        unbind(this.document, "contextmenu", preventDefault);
        unbind(this.document, "pointercancel", this._pointerup);
        return;
    }

    unbind(element, "mousedown", this._mousedown);

    if (!this._mouseOnly) {
        unbind(element, "touchstart", this._touchstart);
        unbind(element, "touchmove", this._touchmove);
        unbind(element, "touchend", this._touchend);
    }
};

Draggable.prototype._usePointers = function _usePointers () {
    return !this._mouseOnly && Draggable.supportPointerEvent();
};

Draggable.prototype.update = function update (ref) {
        var press = ref.press; if ( press === void 0 ) press = noop;
        var drag = ref.drag; if ( drag === void 0 ) drag = noop;
        var release = ref.release; if ( release === void 0 ) release = noop;
        var mouseOnly = ref.mouseOnly; if ( mouseOnly === void 0 ) mouseOnly = false;

    this._pressHandler = proxy(normalizeEvent, press);
    this._dragHandler = proxy(normalizeEvent, drag);
    this._releaseHandler = proxy(normalizeEvent, release);
    this._mouseOnly = mouseOnly;
};

Draggable.prototype.destroy = function destroy () {
    this._unbindFromCurrent();
    this._element = null;
};

Object.defineProperties( Draggable.prototype, prototypeAccessors );

// Re-export as "default" field to address a bug
// where the ES Module is imported by CommonJS code.
//
// See https://github.com/telerik/kendo-angular/issues/1314
Draggable.default = Draggable;

exports.Draggable = Draggable;
exports['default'] = Draggable;

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL2tlbmRvLWRyYWdnYWJsZS9rZW5kby1kcmFnZ2FibGUvc3JjL21haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcHJveHkgPSAoYSwgYikgPT4gKGUpID0+IGIoYShlKSk7XG5cbmNvbnN0IGJpbmQgPSAoZWwsIGV2ZW50LCBjYWxsYmFjaykgPT5cbiAgICBlbC5hZGRFdmVudExpc3RlbmVyICYmIGVsLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIGNhbGxiYWNrKTtcblxuY29uc3QgdW5iaW5kID0gKGVsLCBldmVudCwgY2FsbGJhY2spID0+XG4gICAgZWwgJiYgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lciAmJiBlbC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBjYWxsYmFjayk7XG5cbmNvbnN0IG5vb3AgPSAoKSA9PiB7IC8qIGVtcHR5ICovIH07XG5cbmNvbnN0IHByZXZlbnREZWZhdWx0ID0gZSA9PiBlLnByZXZlbnREZWZhdWx0KCk7XG5cbmNvbnN0IHRvdWNoUmVnRXhwID0gL3RvdWNoLztcblxuLy8gMzAwbXMgaXMgdGhlIHVzdWFsIG1vdXNlIGludGVydmFsO1xuLy8gLy8gSG93ZXZlciwgYW4gdW5kZXJwb3dlcmVkIG1vYmlsZSBkZXZpY2UgdW5kZXIgYSBoZWF2eSBsb2FkIG1heSBxdWV1ZSBtb3VzZSBldmVudHMgZm9yIGEgbG9uZ2VyIHBlcmlvZC5cbmNvbnN0IElHTk9SRV9NT1VTRV9USU1FT1VUID0gMjAwMDtcblxuZnVuY3Rpb24gbm9ybWFsaXplRXZlbnQoZSkge1xuICAgIGlmIChlLnR5cGUubWF0Y2godG91Y2hSZWdFeHApKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwYWdlWDogZS5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCxcbiAgICAgICAgICAgIHBhZ2VZOiBlLmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZLFxuICAgICAgICAgICAgY2xpZW50WDogZS5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRYLFxuICAgICAgICAgICAgY2xpZW50WTogZS5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRZLFxuICAgICAgICAgICAgdHlwZTogZS50eXBlLFxuICAgICAgICAgICAgb3JpZ2luYWxFdmVudDogZSxcbiAgICAgICAgICAgIGlzVG91Y2g6IHRydWVcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBwYWdlWDogZS5wYWdlWCxcbiAgICAgICAgcGFnZVk6IGUucGFnZVksXG4gICAgICAgIGNsaWVudFg6IGUuY2xpZW50WCxcbiAgICAgICAgY2xpZW50WTogZS5jbGllbnRZLFxuICAgICAgICBvZmZzZXRYOiBlLm9mZnNldFgsXG4gICAgICAgIG9mZnNldFk6IGUub2Zmc2V0WSxcbiAgICAgICAgdHlwZTogZS50eXBlLFxuICAgICAgICBjdHJsS2V5OiBlLmN0cmxLZXksXG4gICAgICAgIHNoaWZ0S2V5OiBlLnNoaWZ0S2V5LFxuICAgICAgICBhbHRLZXk6IGUuYWx0S2V5LFxuICAgICAgICBvcmlnaW5hbEV2ZW50OiBlXG4gICAgfTtcbn1cblxuZXhwb3J0IGNsYXNzIERyYWdnYWJsZSB7XG4gICAgc3RhdGljIHN1cHBvcnRQb2ludGVyRXZlbnQoKSB7XG4gICAgICAgIHJldHVybiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpICYmIHdpbmRvdy5Qb2ludGVyRXZlbnQ7XG4gICAgfVxuXG4gICAgZ2V0IGRvY3VtZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZWxlbWVudFxuICAgICAgICA/IHRoaXMuX2VsZW1lbnQub3duZXJEb2N1bWVudFxuICAgICAgICA6IGRvY3VtZW50O1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHsgcHJlc3MgPSBub29wLCBkcmFnID0gbm9vcCwgcmVsZWFzZSA9IG5vb3AsIG1vdXNlT25seSA9IGZhbHNlIH0pIHtcbiAgICAgICAgdGhpcy5fcHJlc3NIYW5kbGVyID0gcHJveHkobm9ybWFsaXplRXZlbnQsIHByZXNzKTtcbiAgICAgICAgdGhpcy5fZHJhZ0hhbmRsZXIgPSBwcm94eShub3JtYWxpemVFdmVudCwgZHJhZyk7XG4gICAgICAgIHRoaXMuX3JlbGVhc2VIYW5kbGVyID0gcHJveHkobm9ybWFsaXplRXZlbnQsIHJlbGVhc2UpO1xuICAgICAgICB0aGlzLl9pZ25vcmVNb3VzZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9tb3VzZU9ubHkgPSBtb3VzZU9ubHk7XG5cbiAgICAgICAgdGhpcy5fdG91Y2hzdGFydCA9IChlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZS50b3VjaGVzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3ByZXNzSGFuZGxlcihlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLl90b3VjaG1vdmUgPSAoZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGUudG91Y2hlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9kcmFnSGFuZGxlcihlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLl90b3VjaGVuZCA9IChlKSA9PiB7XG4gICAgICAgICAgICAvLyB0aGUgbGFzdCBmaW5nZXIgaGFzIGJlZW4gbGlmdGVkLCBhbmQgdGhlIHVzZXIgaXMgbm90IGRvaW5nIGdlc3R1cmUuXG4gICAgICAgICAgICAvLyB0aGVyZSBtaWdodCBiZSBhIGJldHRlciB3YXkgdG8gaGFuZGxlIHRoaXMuXG4gICAgICAgICAgICBpZiAoZS50b3VjaGVzLmxlbmd0aCA9PT0gMCAmJiBlLmNoYW5nZWRUb3VjaGVzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3JlbGVhc2VIYW5kbGVyKGUpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2lnbm9yZU1vdXNlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHRoaXMuX3Jlc3RvcmVNb3VzZSwgSUdOT1JFX01PVVNFX1RJTUVPVVQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuX3Jlc3RvcmVNb3VzZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX2lnbm9yZU1vdXNlID0gZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5fbW91c2Vkb3duID0gKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgd2hpY2ggfSA9IGU7XG5cbiAgICAgICAgICAgIGlmICgod2hpY2ggJiYgd2hpY2ggPiAxKSB8fCB0aGlzLl9pZ25vcmVNb3VzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYmluZCh0aGlzLmRvY3VtZW50LCBcIm1vdXNlbW92ZVwiLCB0aGlzLl9tb3VzZW1vdmUpO1xuICAgICAgICAgICAgYmluZCh0aGlzLmRvY3VtZW50LCBcIm1vdXNldXBcIiwgdGhpcy5fbW91c2V1cCk7XG4gICAgICAgICAgICB0aGlzLl9wcmVzc0hhbmRsZXIoZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5fbW91c2Vtb3ZlID0gKGUpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX2RyYWdIYW5kbGVyKGUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuX21vdXNldXAgPSAoZSkgPT4ge1xuICAgICAgICAgICAgdW5iaW5kKHRoaXMuZG9jdW1lbnQsIFwibW91c2Vtb3ZlXCIsIHRoaXMuX21vdXNlbW92ZSk7XG4gICAgICAgICAgICB1bmJpbmQodGhpcy5kb2N1bWVudCwgXCJtb3VzZXVwXCIsIHRoaXMuX21vdXNldXApO1xuICAgICAgICAgICAgdGhpcy5fcmVsZWFzZUhhbmRsZXIoZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5fcG9pbnRlcmRvd24gPSAoZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGUuaXNQcmltYXJ5ICYmIGUuYnV0dG9uID09PSAwKSB7XG4gICAgICAgICAgICAgICAgYmluZCh0aGlzLmRvY3VtZW50LCBcInBvaW50ZXJtb3ZlXCIsIHRoaXMuX3BvaW50ZXJtb3ZlKTtcbiAgICAgICAgICAgICAgICBiaW5kKHRoaXMuZG9jdW1lbnQsIFwicG9pbnRlcnVwXCIsIHRoaXMuX3BvaW50ZXJ1cCk7XG4gICAgICAgICAgICAgICAgYmluZCh0aGlzLmRvY3VtZW50LCBcInBvaW50ZXJjYW5jZWxcIiwgdGhpcy5fcG9pbnRlcnVwKTtcbiAgICAgICAgICAgICAgICBiaW5kKHRoaXMuZG9jdW1lbnQsIFwiY29udGV4dG1lbnVcIiwgcHJldmVudERlZmF1bHQpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fcHJlc3NIYW5kbGVyKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuX3BvaW50ZXJtb3ZlID0gKGUpID0+IHtcbiAgICAgICAgICAgIGlmIChlLmlzUHJpbWFyeSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RyYWdIYW5kbGVyKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuX3BvaW50ZXJ1cCA9IChlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZS5pc1ByaW1hcnkpIHtcbiAgICAgICAgICAgICAgICB1bmJpbmQodGhpcy5kb2N1bWVudCwgXCJwb2ludGVybW92ZVwiLCB0aGlzLl9wb2ludGVybW92ZSk7XG4gICAgICAgICAgICAgICAgdW5iaW5kKHRoaXMuZG9jdW1lbnQsIFwicG9pbnRlcnVwXCIsIHRoaXMuX3BvaW50ZXJ1cCk7XG4gICAgICAgICAgICAgICAgdW5iaW5kKHRoaXMuZG9jdW1lbnQsIFwicG9pbnRlcmNhbmNlbFwiLCB0aGlzLl9wb2ludGVydXApO1xuICAgICAgICAgICAgICAgIHVuYmluZCh0aGlzLmRvY3VtZW50LCBcImNvbnRleHRtZW51XCIsIHByZXZlbnREZWZhdWx0KTtcblxuICAgICAgICAgICAgICAgIHRoaXMuX3JlbGVhc2VIYW5kbGVyKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGJpbmRUbyhlbGVtZW50KSB7XG4gICAgICAgIGlmIChlbGVtZW50ID09PSB0aGlzLl9lbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5fZWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5fdW5iaW5kRnJvbUN1cnJlbnQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2VsZW1lbnQgPSBlbGVtZW50O1xuICAgICAgICB0aGlzLl9iaW5kVG9DdXJyZW50KCk7XG4gICAgfVxuXG4gICAgX2JpbmRUb0N1cnJlbnQoKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLl9lbGVtZW50O1xuXG4gICAgICAgIGlmICh0aGlzLl91c2VQb2ludGVycygpKSB7XG4gICAgICAgICAgICBiaW5kKGVsZW1lbnQsIFwicG9pbnRlcmRvd25cIiwgdGhpcy5fcG9pbnRlcmRvd24pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgYmluZChlbGVtZW50LCBcIm1vdXNlZG93blwiLCB0aGlzLl9tb3VzZWRvd24pO1xuXG4gICAgICAgIGlmICghdGhpcy5fbW91c2VPbmx5KSB7XG4gICAgICAgICAgICBiaW5kKGVsZW1lbnQsIFwidG91Y2hzdGFydFwiLCB0aGlzLl90b3VjaHN0YXJ0KTtcbiAgICAgICAgICAgIGJpbmQoZWxlbWVudCwgXCJ0b3VjaG1vdmVcIiwgdGhpcy5fdG91Y2htb3ZlKTtcbiAgICAgICAgICAgIGJpbmQoZWxlbWVudCwgXCJ0b3VjaGVuZFwiLCB0aGlzLl90b3VjaGVuZCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfdW5iaW5kRnJvbUN1cnJlbnQoKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLl9lbGVtZW50O1xuXG4gICAgICAgIGlmICh0aGlzLl91c2VQb2ludGVycygpKSB7XG4gICAgICAgICAgICB1bmJpbmQoZWxlbWVudCwgXCJwb2ludGVyZG93blwiLCB0aGlzLl9wb2ludGVyZG93bik7XG4gICAgICAgICAgICB1bmJpbmQodGhpcy5kb2N1bWVudCwgXCJwb2ludGVybW92ZVwiLCB0aGlzLl9wb2ludGVybW92ZSk7XG4gICAgICAgICAgICB1bmJpbmQodGhpcy5kb2N1bWVudCwgXCJwb2ludGVydXBcIiwgdGhpcy5fcG9pbnRlcnVwKTtcbiAgICAgICAgICAgIHVuYmluZCh0aGlzLmRvY3VtZW50LCBcImNvbnRleHRtZW51XCIsIHByZXZlbnREZWZhdWx0KTtcbiAgICAgICAgICAgIHVuYmluZCh0aGlzLmRvY3VtZW50LCBcInBvaW50ZXJjYW5jZWxcIiwgdGhpcy5fcG9pbnRlcnVwKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHVuYmluZChlbGVtZW50LCBcIm1vdXNlZG93blwiLCB0aGlzLl9tb3VzZWRvd24pO1xuXG4gICAgICAgIGlmICghdGhpcy5fbW91c2VPbmx5KSB7XG4gICAgICAgICAgICB1bmJpbmQoZWxlbWVudCwgXCJ0b3VjaHN0YXJ0XCIsIHRoaXMuX3RvdWNoc3RhcnQpO1xuICAgICAgICAgICAgdW5iaW5kKGVsZW1lbnQsIFwidG91Y2htb3ZlXCIsIHRoaXMuX3RvdWNobW92ZSk7XG4gICAgICAgICAgICB1bmJpbmQoZWxlbWVudCwgXCJ0b3VjaGVuZFwiLCB0aGlzLl90b3VjaGVuZCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfdXNlUG9pbnRlcnMoKSB7XG4gICAgICAgIHJldHVybiAhdGhpcy5fbW91c2VPbmx5ICYmIERyYWdnYWJsZS5zdXBwb3J0UG9pbnRlckV2ZW50KCk7XG4gICAgfVxuXG4gICAgdXBkYXRlKHsgcHJlc3MgPSBub29wLCBkcmFnID0gbm9vcCwgcmVsZWFzZSA9IG5vb3AsIG1vdXNlT25seSA9IGZhbHNlIH0pIHtcbiAgICAgICAgdGhpcy5fcHJlc3NIYW5kbGVyID0gcHJveHkobm9ybWFsaXplRXZlbnQsIHByZXNzKTtcbiAgICAgICAgdGhpcy5fZHJhZ0hhbmRsZXIgPSBwcm94eShub3JtYWxpemVFdmVudCwgZHJhZyk7XG4gICAgICAgIHRoaXMuX3JlbGVhc2VIYW5kbGVyID0gcHJveHkobm9ybWFsaXplRXZlbnQsIHJlbGVhc2UpO1xuICAgICAgICB0aGlzLl9tb3VzZU9ubHkgPSBtb3VzZU9ubHk7XG4gICAgfVxuXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5fdW5iaW5kRnJvbUN1cnJlbnQoKTtcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IG51bGw7XG4gICAgfVxufVxuXG4vLyBSZS1leHBvcnQgYXMgXCJkZWZhdWx0XCIgZmllbGQgdG8gYWRkcmVzcyBhIGJ1Z1xuLy8gd2hlcmUgdGhlIEVTIE1vZHVsZSBpcyBpbXBvcnRlZCBieSBDb21tb25KUyBjb2RlLlxuLy9cbi8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vdGVsZXJpay9rZW5kby1hbmd1bGFyL2lzc3Vlcy8xMzE0XG5EcmFnZ2FibGUuZGVmYXVsdCA9IERyYWdnYWJsZTtcblxuLy8gUm9sbHVwIHdvbid0IG91dHB1dCBleHBvcnRzWydkZWZhdWx0J10gb3RoZXJ3aXNlXG5leHBvcnQgZGVmYXVsdCBEcmFnZ2FibGU7XG5cbiJdLCJuYW1lcyI6WyJjb25zdCIsInRoaXMiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQUEsSUFBTSxLQUFLLEdBQUcsVUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLFNBQUcsVUFBQyxDQUFDLEVBQUUsU0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQUEsQ0FBQzs7QUFFdkNBLElBQU0sSUFBSSxHQUFHLFVBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsU0FDL0IsRUFBRSxDQUFDLGdCQUFnQixJQUFJLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLEdBQUEsQ0FBQzs7QUFFaEVBLElBQU0sTUFBTSxHQUFHLFVBQUMsRUFBRSxFQUFF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